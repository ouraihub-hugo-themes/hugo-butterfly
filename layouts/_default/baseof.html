{{- /*
  baseof.html - 基础模板
  所有页面的基础 HTML 结构
  参考: hexo-theme-butterfly/layout/includes/layout.pug
*/ -}}
{{- $pageType := .Kind -}}
{{- $isPost := eq .Kind "page" -}}
{{- $isHome := .IsHome -}}
{{- $section := .Section -}}

{{- /* 判断是否隐藏侧边栏 */ -}}
{{- $hideAside := false -}}
{{- if not .Site.Params.aside.enable -}}
  {{- $hideAside = true -}}
{{- else if eq .Params.aside false -}}
  {{- $hideAside = true -}}
{{- else if and (eq .Kind "section") (eq $section "posts") -}}
  {{- /* 归档页面（/posts/）根据配置决定 */ -}}
  {{- $hideAside = not (default false .Site.Params.aside.display.archive) -}}
{{- else if and (eq .Kind "term") (eq .Type "categories") -}}
  {{- /* 所有分类列表页（/categories/）根据配置决定 */ -}}
  {{- $hideAside = not (default true .Site.Params.aside.display.category) -}}
{{- else if and (eq .Kind "term") (eq .Type "tags") -}}
  {{- /* 所有标签列表页（/tags/）根据配置决定 */ -}}
  {{- $hideAside = not (default true .Site.Params.aside.display.tag) -}}
{{- else if and (eq .Kind "taxonomy") (eq .Type "categories") -}}
  {{- /* 单个分类页面（/categories/xxx/）根据配置决定 */ -}}
  {{- $hideAside = not (default true .Site.Params.aside.display.category) -}}
{{- else if and (eq .Kind "taxonomy") (eq .Type "tags") -}}
  {{- /* 单个标签页面（/tags/xxx/）根据配置决定 */ -}}
  {{- $hideAside = not (default true .Site.Params.aside.display.tag) -}}
{{- end -}}

{{- $asideClass := cond $hideAside "hide-aside" "" -}}
{{- $displayMode := .Site.Params.display_mode | default "light" -}}
<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}" data-theme="{{ $displayMode }}" class="{{ $asideClass }}">
<head>
    {{- partial "head/head.html" . -}}
</head>
<body class="antialiased">
    {{- /* 加载动画 (可选) */ -}}
    {{- if .Site.Params.preloader.enable -}}
        {{- partial "components/loading.html" . -}}
    {{- end -}}

    {{- /* 网站背景 (可选) */ -}}
    {{- if .Site.Params.background -}}
    <div id="web_bg" style="background-image: url('{{ .Site.Params.background }}');"></div>
    {{- end -}}

    {{- /* 侧边栏 (可选) */ -}}
    {{- if .Site.Params.sidebar.enable -}}
        {{- partial "sidebar/sidebar.html" . -}}
    {{- end -}}

    {{- /* 主体包装器 */ -}}
    <div id="body-wrap" class="{{ if $isPost }}post{{ else }}page{{ end }}{{ with .Params.type }} type-{{ . }}{{ end }}">
        {{- /* 页头导航 */ -}}
        {{- partial "header/header.html" . -}}

        {{- /* Hero 区域 (仅首页) */ -}}
        {{- if $isHome -}}
            {{- partial "home/hero.html" . -}}
        {{- end -}}

        {{- /* 主内容区域 */ -}}
        <main id="content-inner" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8" role="main">
            <div class="layout flex flex-col lg:flex-row gap-6{{ if $hideAside }} hide-aside{{ end }}">
                {{- /* 主要内容 */ -}}
                <div class="flex-1 min-w-0">
                    {{- block "main" . }}{{- end }}
                </div>
                
                {{- /* 侧边栏组件 */ -}}
                {{- if not $hideAside -}}
                    {{- block "sidebar" . }}
                        {{- partial "aside/aside.html" . -}}
                    {{- end -}}
                {{- end -}}
            </div>
        </main>

        {{- /* 页脚 */ -}}
        {{- partial "footer/footer.html" . -}}
    </div>

    {{- /* 右侧工具栏 */ -}}
    {{- if .Site.Params.rightside.enable -}}
        {{- partial "components/rightside.html" . -}}
    {{- end -}}
    
    {{- /* 搜索组件 */ -}}
    {{- if .Site.Params.search.enable -}}
        {{- $searchType := .Site.Params.search.type | default "local" -}}
        {{- if eq $searchType "pagefind" -}}
            {{- partial "search/pagefind.html" . -}}
        {{- else -}}
            {{- partial "components/search.html" . -}}
        {{- end -}}
    {{- end -}}
    
    {{- /* 图片灯箱 */ -}}
    {{- partial "components/lightbox.html" . -}}
    
    {{- /* JavaScript 脚本 */ -}}
    {{- partial "scripts/scripts.html" . -}}
    
    {{- /* 页面特定脚本 */ -}}
    {{- block "scripts" . }}{{- end }}
</body>
</html>
